<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thank You For Donating!</title>
    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="./assets/css/style.css" />
    <!-- domToImage -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>

    <style>
        /* Custom styles with Bootstrap breakpoints */
        .name-text {
            padding-bottom: 0px;
            padding-top: 5px;
            font-size: 16px;
        }

        @media (max-width: 576px) { /* Small screens (sm) */
            .name-text {
            padding-bottom: 0px;
            padding-top: 5px;
            font-size: 11px; 
            }
        }

        @media (min-width: 577px) and (max-width: 992px) { /* Medium screens (md) */
            .name-text {
                padding-bottom: 0px;
                padding-top: 15px;
            }
        }

        @media (min-width: 993px) { /* Large screens (lg) */
            .name-text {
                padding-bottom: 20px;
                padding-top: 0px;
            }
        }
    </style>
</head>
<body class="min-vh-100 d-flex align-items-center p-3">
    <div class="container">
        <div class="row g-4">
            <div class="col-lg-6">
                <img alt="" src="./assets/images/logo.svg" class="mb-4" style="height: 100px;"/>
                <p class="fw-bold border-top pt-3 fs-5">Gratitude Challenge Certificate Generator</p>
                <p class="text-muted small">Your generosity during Ramadan has made a real difference! As a token of our appreciation, you can now generate your Certificate of Participation/Donation. <br><br> Thank you for your kindnessâ€”may you be abundantly rewarded!</p>
                
                <form id="donationForm" class="row g-3">
                    <div class="col-12">
                        <label for="fullName" class="form-label">Full Name:</label>
                        <input type="text" id="fullName" name="fullName" class="form-control" placeholder="Enter your full name" required>
                    </div>
                    <div class="col-md-6">
                        <label for="emailAddress" class="form-label">Email Address:</label>
                        <input type="email" id="emailAddress" name="emailAddress" class="form-control" placeholder="Enter your email address" required>
                    </div>
                    <div class="col-md-6">
                        <label for="phoneNumber" class="form-label">Phone Number:</label>
                        <input type="tel" id="phoneNumber" name="phoneNumber" class="form-control" placeholder="Enter your phone number" required>
                    </div>
                    <div class="col-12">
                        <button type="submit" id="submitButton" class="btn btn-dark">Submit</button>
                    </div>
                </form>
            </div>
            <div class="col-lg-6 position-relative" id="captureDiv">
                <img src="./assets/images/certificate.jpg" alt="" class="img-fluid">
                <div class="position-absolute top-50 start-50 translate-middle text-center fw-bold name-font name-text" id="displayName">
                    your name ...
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Modal -->
    <div class="modal fade" id="certificateModal" tabindex="-1" aria-labelledby="certificateModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="certificateModalLabel">Certificate Generated</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Your certificate has been successfully generated. Click the button below to download it.
                </div>
                <div class="modal-footer">
                    <button id="screenshotButton" class="btn btn-success">
                        Download Certificate
                        <img src="./assets/images/download.svg" alt="" class="ms-2" style="height: 20px;">
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById("donationForm").addEventListener("submit", async function (event) {
            event.preventDefault();

            const fullName = document.getElementById("fullName").value.trim();
            const emailAddress = document.getElementById("emailAddress").value.trim();
            const phoneNumber = document.getElementById("phoneNumber").value.trim();
            const displayName = document.getElementById("displayName");
            const submitButton = document.getElementById("submitButton");

            submitButton.disabled = true;
            submitButton.textContent = "Submitting...";

            displayName.textContent = fullName;

            try {
                const response = await fetch("https://sandbox.sunsmartcare.com/v1/api/mosquepay_donation_certificate", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "x-api-key": "21122023"
                    },
                    body: JSON.stringify({ fullName, emailAddress, phoneNumber })
                });

                if (response.ok) {
                    new bootstrap.Modal(document.getElementById("certificateModal")).show();
                } else {
                    alert("Failed to generate certificate. Please try again.");
                }
            } catch (error) {
                alert("An error occurred: " + error.message);
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = "Submit";
            }
        });

        // Screenshot functionality (Download Certificate)
        document.getElementById("screenshotButton").addEventListener("click", function () {
            const captureDiv = document.getElementById("captureDiv");
            const scaleFactor = 3;
            const width = captureDiv.offsetWidth * scaleFactor;
            const height = captureDiv.offsetHeight * scaleFactor;

            domtoimage.toBlob(captureDiv, {
                width: width,
                height: height,
                style: {
                    transform: `scale(${scaleFactor})`,
                    transformOrigin: "top left",
                    width: captureDiv.offsetWidth + "px",
                    height: captureDiv.offsetHeight + "px",
                }
            })
            .then(function (blob) {
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = "Donation_Certificate_UHD.png";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            })
            .catch(function (error) {
                console.error("Error generating high-res image:", error);
            });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
